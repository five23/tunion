<!DOCTYPE html>
<html lang="en">
  <head>
    <title>uni0nsongbook</title>
    <link rel="shortcut icon" href="favicon.ico" />
    <meta charset="utf-8" />
    <meta name="description" content="uni0nsongbook" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  </head>
  <body
    style="-webkit-user-select: none"
    ondragstart="return false;"
    ondrop="return false;"
  >
    <header>
      <div id="header-panel"></div>
    </header>
    <main id="gui">
      <canvas id="view1" width="600" height="300"></canvas>
      <div id="vco1"></div>        
      <div id="vco2"></div>
    </main>
<div id="editor">
  
  
  var fs = 44100; // Process Sampling Frequency
  var fc = 440; // Center frequency
  var z1 = 0.998; // Lowpass Filter Pole (for smoothing controller changes)
  
  var omega = (K.TAU * fc) / fs; // Angular frequency
  
  var vco1 = {
      step: 0,
      theta: 0,
      N: 0,
      out: 0
  }
  
  var vco2 = {
    step: 0,
    theta: 0,
    N: 0,
    out: 0
  }

  function process(buffer) {
    
    // Loop through sample buffer
    for (var t = 0; t < buffer.length; ++t) {
        
        vco1.step = lowpass(window.pos1._x.value, vco1.step, z1);
        vco1.N = lowpass(window.pos1._y.value, vco1.N, z1);
        vco1.theta += vco1.step;

        vco2.step = lowpass(window.pos2._x.value, vco2.step, z1);
        vco2.N = lowpass(window.pos2._y.value, vco2.N, z1);
        vco2.theta += vco2.step;

        vco1.out = 0.25 * K.square12(vco1.theta * omega, vco1.N * 4);
        vco2.out = 0.25 * K.square12(vco2.theta * omega, vco2.N * 4);
        
        buffer[t] = 0.25 * (vco1.out + vco2.out);
    }
    
    // Return buffer
    return buffer;
  }
  
  window.pos1 = window.pos1 || new NexusUI.Position('#vco1',{
    'size': [200,200],
    'mode': 'absolute',
    'x': 0.0,
    'minX': 0,
    'maxX': 1,
    'stepX': 0.00001,
    'y': 0.0,
    'minY': 0,
    'maxY': 1,
    'stepY': 0.00001
  });
  
  window.pos2 = window.pos2 || new NexusUI.Position('#vco2',{
    'size': [200,200],
    'mode': 'absolute',
    'x': 0.0,
    'minX': 0,
    'maxX': 1,
    'stepX': 0.00001,
    'y': 0.0,
    'minY': 0,
    'maxY': 1,
    'stepY': 0.00001
  });

  // Single LPF, suitable for controller changes
  function lowpass(x, n, z) {
    return x + (n - x) * z;
  }
</div>
</body>
</html>
